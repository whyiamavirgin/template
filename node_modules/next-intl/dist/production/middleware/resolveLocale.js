"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("@formatjs/intl-localematcher"),t=require("negotiator"),a=require("../shared/constants.js"),l=require("./utils.js");function o(e){return e&&e.__esModule?e:{default:e}}var n=o(t);function c(t,a,l){let o;const c=new n.default({headers:{"accept-language":t.get("accept-language")||void 0}}).languages();try{o=e.match(c,a,l)}catch(e){}return o}function i(e,t){if(e.has(a.COOKIE_LOCALE_NAME)){var l;const o=null===(l=e.get(a.COOKIE_LOCALE_NAME))||void 0===l?void 0:l.value;if(o&&t.includes(o))return o}}function r(e,t,a,o){let n,{defaultLocale:r,localeDetection:u,localePrefix:s,locales:d}=e;var f;o&&(n=null===(f=l.getPathnameMatch(o,d,s))||void 0===f?void 0:f.locale);return!n&&u&&a&&(n=i(a,d)),!n&&u&&t&&(n=c(t,d,r)),n||(n=r),n}function u(e,t,a,o){const n=function(e,t){var a;let o=l.getHost(e);if(o=null===(a=o)||void 0===a?void 0:a.replace(/:\d+$/,""),o&&t)return t.find((e=>e.domain===o))}(t,e.domains);if(!n)return{locale:r(e,t,a,o)};let u;if(o){var s;const t=null===(s=l.getPathnameMatch(o,e.locales,e.localePrefix))||void 0===s?void 0:s.locale;if(t){if(!l.isLocaleSupportedOnDomain(t,n))return{locale:t,domain:n};u=t}}if(!u&&e.localeDetection&&a){const t=i(a,e.locales);t&&l.isLocaleSupportedOnDomain(t,n)&&(u=t)}if(!u&&e.localeDetection&&t){const a=c(t,n.locales||e.locales,n.defaultLocale);a&&(u=a)}return u||(u=n.defaultLocale),{locale:u,domain:n}}exports.default=function(e,t,a,l){return e.domains?u(e,t,a,l):{locale:r(e,t,a,l)}},exports.getAcceptLanguageLocale=c;
